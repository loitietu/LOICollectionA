on:
    pull_request:
    push:
    workflow_dispatch:

jobs:
    build:
        runs-on: windows-latest
        steps:
            - uses: actions/checkout@v4
            - uses: xmake-io/github-action-setup-xmake@v1
            - uses: actions/cache@v4
              with:
                path: |
                    ~/AppData/Local/.xmake
                key: xmake-${{ hashFiles('xmake.lua') }}
                restore-keys: |
                    xmake-
            
            - run: |
                xmake repo -u
            
            - run: |
                xmake lua scripts/project.lua
            
            - name: Build with Original
              run: |
                xmake f -a x64 -m release -p windows -v -y --shared=true
                xmake -v -y
            
            - name: Upload artifact original
              uses: actions/upload-artifact@v4
              with:
                name: ${{ github.event.repository.name }}-windows-x64-${{ github.sha }}
                path: |
                    bin/

            - name: Build with Extended Static
              run: |
                xmake f -a x64 -m release -p windows -v -y --shared=false
                xmake -v -y
            
            - name: Upload artifact Extended Static
              uses: actions/upload-artifact@v4
              with:
                name: ${{ github.event.repository.name }}-ES-windows-x64-${{ github.sha }}
                path: |
                    bin/